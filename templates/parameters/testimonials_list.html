{% extends 'base.html' %}
{% load static %}

{% block title %}Testimonials Management - {{ site_settings.site_name }}{% endblock %}

{% block extra_css %}
<style>
    .testimonials-header {
        background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0.5rem;
    }
    
    .testimonial-card {
        background: white;
        border: 1px solid var(--bs-border-color);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .testimonial-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    .testimonial-card.featured {
        border-color: var(--theme-primary);
        background: linear-gradient(135deg, rgba(var(--theme-primary), 0.05), rgba(var(--theme-secondary), 0.05));
    }
    
    .testimonial-content {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .quote-icon {
        position: absolute;
        top: -10px;
        left: -10px;
        font-size: 2rem;
        color: var(--theme-primary);
        opacity: 0.3;
    }
    
    .testimonial-text {
        font-size: 1.1rem;
        line-height: 1.6;
        color: var(--bs-dark);
        font-style: italic;
        padding-left: 1rem;
    }
    
    .testimonial-author {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .author-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--theme-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.25rem;
        flex-shrink: 0;
    }
    
    .author-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
    }
    
    .author-info {
        flex: 1;
    }
    
    .author-name {
        font-weight: 600;
        color: var(--bs-dark);
        margin-bottom: 0.25rem;
    }
    
    .author-title {
        color: var(--bs-secondary-color);
        font-size: 0.9rem;
    }
    
    .author-company {
        color: var(--theme-primary);
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .testimonial-meta {
        display: flex;
        justify-content: between;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .testimonial-rating {
        display: flex;
        gap: 0.25rem;
    }
    
    .star {
        color: #ffd700;
        font-size: 1.25rem;
    }
    
    .star.empty {
        color: #e9ecef;
    }
    
    .testimonial-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .badge-featured {
        background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .badge-verified {
        background: #28a745;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .testimonial-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border: 1px solid var(--bs-border-color);
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: var(--theme-primary);
        display: block;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: var(--bs-secondary-color);
        font-size: 0.875rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .add-testimonial-card {
        background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
        color: white;
        border: none;
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        margin-bottom: 2rem;
        cursor: pointer;
    }
    
    .add-testimonial-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--bs-secondary-color);
    }
    
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .filter-bar {
        background: #f8f9fa;
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 2rem;
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .project-tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
    }
    
    .project-tag {
        background: #e9ecef;
        color: #495057;
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="testimonials-header text-center">
        <div class="container">
            <h1 class="mb-3">
                <i class="bi bi-chat-quote-fill me-3"></i>
                Testimonials Management
            </h1>
            <p class="mb-0 fs-5">Showcase client feedback and build trust</p>
        </div>
    </div>
    
    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-number">{{ total_testimonials|default:"0" }}</span>
            <div class="stat-label">Total Testimonials</div>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ featured_testimonials|default:"0" }}</span>
            <div class="stat-label">Featured</div>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ average_rating|default:"0.0" }}</span>
            <div class="stat-label">Average Rating</div>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ verified_testimonials|default:"0" }}</span>
            <div class="stat-label">Verified</div>
        </div>
    </div>
    
    <!-- Add New Testimonial -->
    <div class="add-testimonial-card" data-bs-toggle="modal" data-bs-target="#addTestimonialModal">
        <div class="row align-items-center">
            <div class="col-md-8 text-start">
                <h3 class="mb-2">
                    <i class="bi bi-plus-circle me-2"></i>
                    Add New Testimonial
                </h3>
                <p class="mb-0">Collect and showcase client feedback</p>
            </div>
            <div class="col-md-4 text-end">
                <i class="bi bi-chat-heart display-4"></i>
            </div>
        </div>
    </div>
    
    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="flex-grow-1">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <select class="form-select" id="filterRating">
                        <option value="">All Ratings</option>
                        <option value="5">5 Stars</option>
                        <option value="4">4+ Stars</option>
                        <option value="3">3+ Stars</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterStatus">
                        <option value="">All Status</option>
                        <option value="featured">Featured</option>
                        <option value="verified">Verified</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="searchTestimonials" placeholder="Search testimonials...">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-primary w-100" onclick="clearFilters()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Testimonials List -->
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>
                    <i class="bi bi-collection me-2"></i>
                    Client Testimonials
                </h3>
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary" onclick="exportTestimonials()">
                        <i class="bi bi-download me-2"></i>
                        Export
                    </button>
                    <button class="btn btn-outline-success" onclick="previewTestimonials()">
                        <i class="bi bi-eye me-2"></i>
                        Preview
                    </button>
                </div>
            </div>
            
            <div id="testimonialsList">
                {% if testimonials %}
                    {% for testimonial in testimonials %}
                    <!-- Sample testimonials will be loaded here -->
                    {% endfor %}
                {% else %}
                <!-- Sample Testimonials for Demo -->
                <div class="testimonial-card featured">
                    <div class="testimonial-content">
                        <div class="quote-icon">
                            <i class="bi bi-quote"></i>
                        </div>
                        <div class="testimonial-text">
                            "Working with {{ site_settings.owner_name|default:"this developer" }} was an absolute pleasure. They delivered a stunning website that exceeded all our expectations. The attention to detail and professional communication throughout the project was outstanding."
                        </div>
                    </div>
                    
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <span>SK</span>
                        </div>
                        <div class="author-info">
                            <div class="author-name">Sarah Johnson</div>
                            <div class="author-title">Marketing Director</div>
                            <div class="author-company">TechStart Inc.</div>
                        </div>
                    </div>
                    
                    <div class="testimonial-meta">
                        <div class="testimonial-rating">
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                        </div>
                        <div class="testimonial-badges">
                            <span class="badge-featured">Featured</span>
                            <span class="badge-verified">Verified</span>
                        </div>
                    </div>
                    
                    <div class="project-tags">
                        <span class="project-tag">Web Development</span>
                        <span class="project-tag">E-commerce</span>
                        <span class="project-tag">React</span>
                    </div>
                    
                    <div class="testimonial-actions">
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil me-1"></i>Edit
                        </button>
                        <button class="btn btn-outline-warning btn-sm">
                            <i class="bi bi-star me-1"></i>Unfeature
                        </button>
                        <button class="btn btn-outline-info btn-sm">
                            <i class="bi bi-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
                
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <div class="quote-icon">
                            <i class="bi bi-quote"></i>
                        </div>
                        <div class="testimonial-text">
                            "Exceptional work on our mobile app project. The developer was responsive, creative, and delivered on time. Our app store ratings improved significantly after the redesign."
                        </div>
                    </div>
                    
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <span>MC</span>
                        </div>
                        <div class="author-info">
                            <div class="author-name">Michael Chen</div>
                            <div class="author-title">Product Manager</div>
                            <div class="author-company">AppFlow Solutions</div>
                        </div>
                    </div>
                    
                    <div class="testimonial-meta">
                        <div class="testimonial-rating">
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star star empty"></i>
                        </div>
                        <div class="testimonial-badges">
                            <span class="badge-verified">Verified</span>
                        </div>
                    </div>
                    
                    <div class="project-tags">
                        <span class="project-tag">Mobile Development</span>
                        <span class="project-tag">React Native</span>
                        <span class="project-tag">UI/UX Design</span>
                    </div>
                    
                    <div class="testimonial-actions">
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil me-1"></i>Edit
                        </button>
                        <button class="btn btn-outline-success btn-sm">
                            <i class="bi bi-star me-1"></i>Feature
                        </button>
                        <button class="btn btn-outline-info btn-sm">
                            <i class="bi bi-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
                
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <div class="quote-icon">
                            <i class="bi bi-quote"></i>
                        </div>
                        <div class="testimonial-text">
                            "Professional, reliable, and skilled. The portfolio website they created perfectly represents our brand and has helped us attract new clients."
                        </div>
                    </div>
                    
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <span>ED</span>
                        </div>
                        <div class="author-info">
                            <div class="author-name">Emily Davis</div>
                            <div class="author-title">CEO</div>
                            <div class="author-company">Creative Studio</div>
                        </div>
                    </div>
                    
                    <div class="testimonial-meta">
                        <div class="testimonial-rating">
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                            <i class="bi bi-star-fill star"></i>
                        </div>
                        <div class="testimonial-badges">
                            <span class="badge-verified">Verified</span>
                        </div>
                    </div>
                    
                    <div class="project-tags">
                        <span class="project-tag">Portfolio Design</span>
                        <span class="project-tag">Branding</span>
                        <span class="project-tag">WordPress</span>
                    </div>
                    
                    <div class="testimonial-actions">
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil me-1"></i>Edit
                        </button>
                        <button class="btn btn-outline-success btn-sm">
                            <i class="bi bi-star me-1"></i>Feature
                        </button>
                        <button class="btn btn-outline-info btn-sm">
                            <i class="bi bi-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Add Testimonial Modal -->
<div class="modal fade" id="addTestimonialModal" tabindex="-1" aria-labelledby="addTestimonialModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTestimonialModalLabel">
                    <i class="bi bi-plus-circle me-2"></i>
                    Add New Testimonial
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addTestimonialForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="clientName" class="form-label">Client Name</label>
                                <input type="text" class="form-control" id="clientName" placeholder="e.g., John Smith">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="clientEmail" class="form-label">Email (Optional)</label>
                                <input type="email" class="form-control" id="clientEmail" placeholder="john@company.com">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="clientTitle" class="form-label">Job Title</label>
                                <input type="text" class="form-control" id="clientTitle" placeholder="e.g., CEO, Marketing Director">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="clientCompany" class="form-label">Company</label>
                                <input type="text" class="form-control" id="clientCompany" placeholder="e.g., Tech Corp Inc.">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="testimonialText" class="form-label">Testimonial Content</label>
                        <textarea class="form-control" id="testimonialText" rows="4" placeholder="Enter the client's testimonial here..."></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="projectRating" class="form-label">Rating</label>
                                <select class="form-select" id="projectRating">
                                    <option value="5">5 Stars - Excellent</option>
                                    <option value="4">4 Stars - Very Good</option>
                                    <option value="3">3 Stars - Good</option>
                                    <option value="2">2 Stars - Fair</option>
                                    <option value="1">1 Star - Poor</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="projectTags" class="form-label">Project Tags</label>
                                <input type="text" class="form-control" id="projectTags" placeholder="e.g., Web Development, React, E-commerce">
                                <small class="form-text text-muted">Separate tags with commas</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="clientAvatar" class="form-label">Avatar Image (Optional)</label>
                                <input type="file" class="form-control" id="clientAvatar" accept="image/*">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="isFeatured">
                                    <label class="form-check-label" for="isFeatured">
                                        Featured Testimonial
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="isVerified" checked>
                                    <label class="form-check-label" for="isVerified">
                                        Verified Client
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="showOnHomepage">
                                    <label class="form-check-label" for="showOnHomepage">
                                        Show on Homepage
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveTestimonial()">
                    <i class="bi bi-check-lg me-2"></i>
                    Save Testimonial
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function clearFilters() {
    document.getElementById('filterRating').value = '';
    document.getElementById('filterStatus').value = '';
    document.getElementById('searchTestimonials').value = '';
    filterTestimonials();
}

function filterTestimonials() {
    const rating = document.getElementById('filterRating').value;
    const status = document.getElementById('filterStatus').value;
    const search = document.getElementById('searchTestimonials').value.toLowerCase();
    
    console.log('Filtering testimonials:', { rating, status, search });
    // Implement filtering logic here
}

function exportTestimonials() {
    console.log('Exporting testimonials');
    alert('Testimonials would be exported as CSV/PDF');
}

function previewTestimonials() {
    console.log('Previewing testimonials');
    alert('Preview of how testimonials appear on the site');
}

function saveTestimonial() {
    const testimonialData = {
        name: document.getElementById('clientName').value,
        email: document.getElementById('clientEmail').value,
        title: document.getElementById('clientTitle').value,
        company: document.getElementById('clientCompany').value,
        content: document.getElementById('testimonialText').value,
        rating: document.getElementById('projectRating').value,
        tags: document.getElementById('projectTags').value,
        featured: document.getElementById('isFeatured').checked,
        verified: document.getElementById('isVerified').checked,
        homepage: document.getElementById('showOnHomepage').checked
    };
    
    // Validate required fields
    if (!testimonialData.name || !testimonialData.content) {
        alert('Please fill in the client name and testimonial content');
        return;
    }
    
    console.log('Saving testimonial:', testimonialData);
    alert('Testimonial saved successfully!');
    
    // Close modal and reset form
    const modal = bootstrap.Modal.getInstance(document.getElementById('addTestimonialModal'));
    modal.hide();
    document.getElementById('addTestimonialForm').reset();
}

// Initialize event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Filter event listeners
    document.getElementById('filterRating').addEventListener('change', filterTestimonials);
    document.getElementById('filterStatus').addEventListener('change', filterTestimonials);
    document.getElementById('searchTestimonials').addEventListener('input', filterTestimonials);
    
    // Testimonial card hover effects
    const testimonialCards = document.querySelectorAll('.testimonial-card');
    testimonialCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(-2px)';
        });
    });
});
</script>
{% endblock %}