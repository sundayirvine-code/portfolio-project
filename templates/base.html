{% load static %}
<!DOCTYPE html>
<html lang="en" data-bs-theme="{% if site_settings.default_mode == 'dark' %}dark{% elif site_settings.default_mode == 'light' %}light{% else %}auto{% endif %}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- SEO Meta Tags -->
    <title>{% block title %}{{ site_settings.site_name }}{% if site_settings.site_tagline %} - {{ site_settings.site_tagline }}{% endif %}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{{ site_settings.meta_description|default:site_settings.site_description }}{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}{{ site_settings.meta_keywords }}{% endblock %}">
    <meta name="author" content="{{ site_settings.site_name }}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{{ site_settings.site_name }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ site_settings.meta_description|default:site_settings.site_description }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ site_settings.site_url }}{% block og_url %}{{ request.get_full_path }}{% endblock %}">
    <meta property="og:site_name" content="{{ site_settings.site_name }}">
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{{ site_settings.site_name }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ site_settings.meta_description|default:site_settings.site_description }}{% endblock %}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Animate.css -->
    {% if site_settings.enable_animations %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    {% endif %}
    
    <!-- AOS (Animate On Scroll) -->
    {% if site_settings.enable_animations %}
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
    {% endif %}
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/font-picker.css' %}">
    <link rel="stylesheet" href="{% static 'css/font-size.css' %}">
    <link rel="stylesheet" href="{% static 'css/section-backgrounds.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/themes.css' %}">
    
    {% block extra_css %}{% endblock %}
    
    <!-- Dynamic Theme CSS Variables -->
    <style id="theme-variables">
        :root {
            {% if active_palette %}
            /* Light Mode Colors */
            --bs-primary: {{ active_palette.light_primary }};
            --bs-secondary: {{ active_palette.light_secondary }};
            --bs-accent: {{ active_palette.light_accent }};
            --bg-primary: {{ active_palette.light_background }};
            --text-primary: {{ active_palette.light_text }};
            
            /* Custom Portfolio Colors */
            --portfolio-primary: {{ active_palette.light_primary }};
            --portfolio-secondary: {{ active_palette.light_secondary }};
            --portfolio-accent: {{ active_palette.light_accent }};
            --portfolio-bg: {{ active_palette.light_background }};
            --portfolio-text: {{ active_palette.light_text }};
            {% endif %}
        }
        
        [data-bs-theme="dark"] {
            {% if active_palette %}
            /* Dark Mode Colors */
            --bs-primary: {{ active_palette.dark_primary }};
            --bs-secondary: {{ active_palette.dark_secondary }};
            --bs-accent: {{ active_palette.dark_accent }};
            --bg-primary: {{ active_palette.dark_background }};
            --text-primary: {{ active_palette.dark_text }};
            
            /* Custom Portfolio Colors */
            --portfolio-primary: {{ active_palette.dark_primary }};
            --portfolio-secondary: {{ active_palette.dark_secondary }};
            --portfolio-accent: {{ active_palette.dark_accent }};
            --portfolio-bg: {{ active_palette.dark_background }};
            --portfolio-text: {{ active_palette.dark_text }};
            {% endif %}
        }
    </style>
</head>

<body class="{% block body_class %}{% endblock %}">
    <!-- Skip to main content for accessibility -->
    <a class="visually-hidden-focusable" href="#main-content">Skip to main content</a>
    
    <!-- Navigation -->
    {% include 'components/navigation.html' %}
    
    <!-- Main Content -->
    <main id="main-content" class="{% block main_class %}{% endblock %}">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    {% include 'components/footer.html' %}
    
    <!-- Theme Toggle Button -->
    <button type="button" class="btn btn-outline-primary position-fixed theme-toggle" 
            style="bottom: 20px; right: 20px; z-index: 1050; border-radius: 50%; width: 50px; height: 50px;"
            id="theme-toggle" 
            aria-label="Toggle theme">
        <i class="bi bi-sun-fill" id="theme-icon"></i>
    </button>
    
    <!-- Back to Top Button -->
    <button type="button" class="btn btn-primary position-fixed back-to-top" 
            style="bottom: 80px; right: 20px; z-index: 1050; border-radius: 50%; width: 50px; height: 50px; display: none;"
            id="back-to-top" 
            aria-label="Back to top">
        <i class="bi bi-arrow-up"></i>
    </button>
    
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
         style="background-color: rgba(var(--bs-body-bg-rgb), 0.8); z-index: 9999; display: none !important;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AOS (Animate On Scroll) -->
    {% if site_settings.enable_animations %}
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
    {% endif %}
    
    <!-- Custom JavaScript -->
    <script src="{% static 'js/theme.js' %}"></script>
    <script src="{% static 'js/fonts.js' %}"></script>
    <script src="{% static 'js/font-size.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
    
    <!-- Initialize AOS -->
    {% if site_settings.enable_animations %}
    <script>
        AOS.init({
            duration: 1000,
            once: true,
            offset: 100,
            disable: 'mobile'
        });
    </script>
    {% endif %}
    
    <!-- Google Analytics -->
    {% if site_settings.google_analytics_id %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site_settings.google_analytics_id }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site_settings.google_analytics_id }}');
    </script>
    {% endif %}
    
    <!-- Site Variables for JavaScript -->
    <script>
        window.SITE_CONFIG = {
            'ENABLE_ANIMATIONS': {% if site_settings.enable_animations %}true{% else %}false{% endif %},
            'DEFAULT_THEME': '{{ site_settings.default_mode }}',
            'ACTIVE_PALETTE': '{{ active_palette.slug|default:"electric_neon" }}',
            'ACTIVE_FONT_PALETTE': '{{ site_settings.active_font_palette|default:"modern_professional" }}',
            'BASE_FONT_SIZE': '{{ site_settings.base_font_size|default:"16px" }}',
            'HEADING_FONT_SCALE': {{ site_settings.heading_font_scale|default:1.25 }},
            'SMALL_FONT_SCALE': {{ site_settings.small_font_scale|default:0.875 }},
            'API_BASE_URL': '/api/',
            'SITE_NAME': '{{ site_settings.site_name|escapejs }}'
        };
    </script>
</body>
</html>